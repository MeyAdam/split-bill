const addPeopleLink = document.querySelector(".add-people-link");

addPeopleLink.addEventListener("click", () => {
  let nameList = document.querySelector(".name-list"),
    addPeople = `
      <div class="people-name">
        <input type="text" class="input-name" placeholder="Name">
        <input type="text" class="input-total" placeholder="RM">
      </div>`;
  nameList.insertAdjacentHTML("beforeend", addPeople);
});

let serviceTax = 0;
const incServiceTax = document.querySelector(".inc-service-tax");

incServiceTax.addEventListener("change", () => {
  serviceTax = isNaN(serviceTax = parseFloat(incServiceTax.value)) ? serviceTax = 0 : serviceTax
});

let serviceCharge = 0;
const inputServiceCharge = document.querySelector(".service-charge input");

function roundToFive(e) {
  return Math.round(20 * e) / 20
}

inputServiceCharge.addEventListener("change", () => {
  serviceCharge = isNaN(serviceCharge = parseFloat(inputServiceCharge.value)) ? serviceCharge = 0 : serviceCharge
});

const btn = document.querySelector(".btn");
btn.addEventListener("click", () => {
  let calculateDiv = document.querySelector(".calculate-div");
  calculateDiv.style.display = "inherit";
  calculateDiv.style.marginTop = "40px";

  let totalPercent = (serviceTax + serviceCharge) / 100;

  inputNames = document.querySelectorAll(".input-name");
  inputTotals = document.querySelectorAll(".input-total");

  tableRows = "";

  sumTotal = 0;
  for (let i = 0; i < inputTotals.length; i++) {
    let nameValue = inputNames[i].value;
    
    totalValue = eval(inputTotals[i].value.replace(/[^0-9+\-*/.()]/g, ""));
    totalValue += totalValue * totalPercent;
    sumTotal += parseFloat(totalValue = isNaN(totalValue = roundToFive(totalValue)) ? 0 : totalValue), 0 !== totalValue && (tableRows += `
      <tr>
        <td>${nameValue}</td>
        <td>${totalValue}</td>
      </tr>`)
  };

  let table = `
    <table>
      <tr>
        <th class="cell-title">Name</th>
        <th>RM</th>
      </tr>
        ${tableRows}
      <tr>
        <td class="totalTxt" style="text-align:right;">TOTAL</td>
        <td>${sumTotal.toFixed(2)}</td>
      </tr>
    </table>`;

  createTable = document.querySelector(".create-table");
  createTable.innerHTML = table;
});